```mermaid
classDiagram
direction TB
    note("医療DX参考資料>02_電子処方箋>記録条件仕様>処方調剤を参照")
    note("電子処方箋管理サービス記録条件仕様（処方編）_Ver1.8.pdf")
    note("電子処方箋管理サービス記録条件仕様（調剤編）_Ver1.9.pdf")
    note("別紙_記録条件仕様XML定義表.pdf")
    note("xxxレコードは記録条件仕様上の名称")
    note("省略可のレコードは対応を記載していない")
    note("記録条件仕様上との比較をするために、処方箋モデルが持つ値も明記している")

    class 電子処方箋["電子処方箋・処方箋情報提供(外部接続・電子処方箋)"] {
        電子処方箋ID PK
        処方箋ID FK
        電子処方箋管理・処方箋ID 電子処方箋管理サービス上のID
        医療機関ID FK 医療機関レコード、医療機関所在地レコード、医療機関電話レコード
        診療科ID FK 診療科レコード
        医師ID FK 医師レコード、麻薬施用レコード
        患者ID FK 患者氏名レコード、患者性別レコード、患者生年月日レコード
        保険情報ID FK 患者一部負担レコード、保険種別レコード、保険者番号レコード、記号番号レコード、負担・給付率レコード、職務上の事由レコード、レセプト種別レコード
        公費ID[] FK 負担・給付率レコード、第一公費レコード、第二公費レコード、第三公費レコード、特殊公費レコード
        交付年月日 処方箋交付年月日レコード
        使用期限年月日 使用期限年月日レコード
        リフィル
        引換番号 処方箋番号レコード
        状態 登録済み、削除済みなど
        登録日時
        登録結果
        残薬確認対応フラグ 残薬確認レコード
        リフィル回数 リフィル処方箋情報レコード
        備考種別 備考レコード
        備考 備考レコード
        補足("登録日時など電子処方箋管理サービスとの同期情報は暫定")
        補足("紙の処方箋を発行する場合は、処方箋情報提供を電子署名なしで電子処方箋管理サービスに登録する")
        補足("残薬確認対応フラグ: データが入力されるフローを確認する")
    }
    電子署名 "0..1" -- "1" 電子処方箋

    class RP剤情報["RP剤情報(外部接続・電子処方箋)"] {
        剤形ID PK
        電子処方箋ID FK
        RP番号 剤形レコード
        剤形区分 剤形レコード 内服、頓服、外用、内服滴剤、注射、医療材料、不明
        剤形名称 剤形レコード 剤形区分が不明な場合に任意の文字列を記録する
        調剤数量 剤形レコード 日数または回数
        電子処方箋用法マスタコード JAMI標準用法コード 用法レコード
        用法名称 用法レコード マスタにない用法を記載する場合に使用
        1日回数 用法レコード
        対応("電子処方箋・剤形レコード、電子処方箋・用法レコードを統合")
    }
    RP剤情報 "1..n" -- "1" 電子処方箋

    class 用法補足["RP剤情報(外部接続・電子処方箋)"] {
    }

    class 電子署名["電子処方箋(外部接続・電子処方箋)"] {
        HPKI署名
        タイムスタンプ
        対応("署名")
        補足("電子処方箋XMLに付与するものなので、エンティティにすることには違和感があるがデジ庁に合わせる")
        補足("処方箋情報提供の場合は電子署名は不要")
    }
    電子署名 "0..1" -- "1" 電子処方箋
```
