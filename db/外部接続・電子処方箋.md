```mermaid
classDiagram
direction TB
    note("医療DX参考資料>02_電子処方箋>記録条件仕様>処方調剤を参照")
    note("電子処方箋管理サービス記録条件仕様（処方編）_Ver1.8.pdf")
    note("電子処方箋管理サービス記録条件仕様（調剤編）_Ver1.9.pdf")
    note("別紙_記録条件仕様XML定義表.pdf")
    note("xxxレコードは記録条件仕様上の名称")
    note("他のエンティティと対応しない省略可、任意のレコードは除外")
    note("記録条件仕様上との比較をするために、処方箋モデルが持つ値も明記している")

    class 電子処方箋["電子処方箋・処方箋情報提供(電子処方箋・外部接続)"] {
        電子処方箋ID PK
        処方箋ID FK
        電子処方箋管理・処方箋ID 電子処方箋管理サービス上のID
        医療機関ID FK 医療機関レコード、医療機関所在地レコード、医療機関電話レコード
        診療科ID FK 診療科レコード
        医師ID FK 医師レコード、麻薬施用レコード
        患者ID FK 患者氏名レコード、患者性別レコード、患者生年月日レコード
        保険情報ID FK 患者一部負担レコード、保険種別レコード、保険者番号レコード、記号番号レコード、負担・給付率レコード、職務上の事由レコード、レセプト種別レコード
        公費ID[] FK 負担・給付率レコード、第一公費レコード、第二公費レコード、第三公費レコード、特殊公費レコード
        交付年月日 処方箋交付年月日レコード
        使用期限年月日 使用期限年月日レコード
        リフィル
        引換番号 処方箋番号レコード
        状態 登録済み、削除済みなど
        登録日時
        登録結果
        残薬確認対応フラグ 残薬確認レコード
        リフィル回数 リフィル処方箋情報レコード
        備考種別 備考レコード
        備考 備考レコード
        補足("登録日時など電子処方箋管理サービスとの同期情報は暫定")
        補足("紙の処方箋を発行する場合は、処方箋情報提供を電子署名なしで電子処方箋管理サービスに登録する")
        補足("残薬確認対応フラグ: データが入力されるフローを確認する")
    }
    電子署名 "0..1" -- "1" 電子処方箋

    class RP剤情報["RP剤情報(電子処方箋・外部接続)"] {
        剤形ID PK
        電子処方箋ID FK
        RP番号 剤形レコード
        剤形区分 剤形レコード 内服、頓服、外用、内服滴剤、注射、医療材料、不明
        剤形名称 剤形レコード 剤形区分が不明な場合に任意の文字列を記録する
        調剤数量 剤形レコード 日数または回数
        電子処方箋用法マスタコード JAMI標準用法コード 用法レコード
        用法名称 用法レコード マスタにない用法を記載する場合に使用
        1日回数 用法レコード
        対応("電子処方箋・剤形レコード、電子処方箋・用法レコードを統合")
    }
    RP剤情報 "1..n" -- "1" 電子処方箋

    class 用法補足["用法補足(電子処方箋・外部接続)"] {
        用法補足ID PK
        RP剤情報ID FK
        連番
        用法補足区分
        用法補足情報
        補足用法コード JAMI補足用法の場合に補足用法コードを記録
        部位コード JAMI部位の場合にJAMI外用部位コードを記録
        対応("電子処方箋・用法補足レコード")
    }
    用法補足 "0..n" -- "1" RP剤情報

    class 薬品["薬品(電子処方箋・外部接続)"] {
        薬品ID PK
        RP剤情報ID FK
        RP内連番
        情報区分 医薬品または医療材料
        薬品コード種別 レセプト電産処理システムコード、YJコード、一般名コード
        薬品コード
        薬品名称 薬品レコードで必須になっているので明記、コード不明の場合は任意の文字列を記載
        分量
        力価フラグ
        単位名
        対応("電子処方箋・薬品レコード")
        補足("医療材料はレセプト電産処理システムコードで記録")
    }
    薬品 "1..n" -- "1" RP剤情報

    class 不均等["不均等(電子処方箋・外部接続)"] {
        不均等ID PK
        薬品ID FK
        1回目服用量
        1回目服用量コード JAMI補足用法コード
        2回目服用量
        2回目服用量コード JAMI補足用法コード
        3回目服用量
        3回目服用量コード JAMI補足用法コード
        4回目服用量
        4回目服用量コード JAMI補足用法コード
        5回目服用量
        5回目服用量コード JAMI補足用法コード
        対応("電子処方箋・不均等レコード")
        補足("不均等は頻出ではなく項目も多いので、別エンティティとした")
    }
    不均等 "0..1" -- "1" 薬品

    class 薬品負担区分["薬品負担区分(電子処方箋・外部接続)"] {
        薬品負担区分ID PK
        薬品ID FK
        第一公費負担区分
        第二公費負担区分
        第三公費負担区分
        特殊公費負担区分
        対応("電子処方箋・負担区分レコード")
        補足("RP内に保険・公費の適用が異なる薬品がある場合に使用するが、そもそも入力を許容するかなど検討が必要")
    }
    薬品負担区分 "0..1" -- "1" 薬品

    class 薬品補足["薬品補足(電子処方箋・外部接続)"] {
        薬品補足ID PK
        薬品ID FK
        薬品補足連番
        薬品補足区分 一包化、粉砕、後発品変更不可など
        薬品補足情報
        補足薬品コード JAMI補足用法の場合に補足用法コードを記録
        対応("電子処方箋・薬品補足レコード")
    }
    薬品補足 "0..n" -- "1" 薬品

    class 提供診療情報["提供診療情報(電子処方箋・外部接続)"] {
        提供診療情報ID PK
        電子処方箋ID FK
        薬品ID FK nullable 特定の薬品レコードに対する場合に記録
        連番
        コメント
        対応("電子処方箋・提供診療情報レコード")
    }
    提供診療情報 "0..n" -- "1" 電子処方箋

    class 検査値データ等["検査値データ等(電子処方箋・外部接続)"] {
        検査値データ等ID PK
        電子処方箋ID FK
        連番
        検査値データ等 任意の文字列
        対応("電子処方箋・検査値データ等レコード")
    }
    検査値データ等 "0..n" -- "1" 電子処方箋

    class 電子署名["電子処方箋(電子処方箋・外部接続)"] {
        電子署名ID PK
        電子処方箋ID FK
        HPKI署名
        タイムスタンプ
        対応("署名")
        補足("電子処方箋XMLに付与するものなので、エンティティにすることには違和感があるがデジ庁に合わせる")
        補足("処方箋情報提供の場合は電子署名は不要")
    }
    電子署名 "0..1" -- "1" 電子処方箋
```
